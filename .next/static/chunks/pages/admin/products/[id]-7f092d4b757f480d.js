(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2265],{40050:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/products/[id]",function(){return t(39526)}])},39526:function(e,s,t){"use strict";t.r(s);var r=t(85893),o=t(67294),a=t(11163),i=t(82175),c=t(16310),n=t(5152),l=t.n(n),d=t(66308),u=t(57407),m=t(65858),h=(t(37676),t(83454));const f="https://miet-backend-five.vercel.app",x=l()((()=>Promise.all([t.e(2937),t.e(8446),t.e(1167)]).then(t.t.bind(t,71167,23))),{loadableGenerated:{webpack:()=>[71167]},ssr:!1,loading:()=>(0,r.jsx)("p",{children:"Loading editor..."})}),p=(h.env.NEXT_PUBLIC_TINYMCE_API_KEY,c.Ry({name:c.Z_().required("Name is required"),description:c.Z_().required("Description is required"),price:c.Rx().min(0,"Price must be positive").required("Price is required"),stock:c.Rx().min(0,"Stock must be positive").required("Stock is required"),categoryId:c.Z_().required("Category is required"),status:c.Z_().oneOf(["active","inactive"]).required("Status is required"),features:c.IX().of(c.Z_()),specifications:c.Ry(),images:c.IX().min(1,"At least one image is required")}));s.default=(0,m.Q)((function(){const e=(0,a.useRouter)(),{id:s}=e.query,t=Boolean(s),[c,n]=(0,o.useState)(!0),[l,m]=(0,o.useState)(!1),[h,g]=(0,o.useState)([]),[b,w]=(0,o.useState)([]),[v,y]=(0,o.useState)([]),[j,N]=(0,o.useState)({show:!1,message:"",type:"success"}),k=(0,i.TA)({initialValues:{name:"",description:"",price:"",stock:"",categoryId:"",status:"active",features:[""],specifications:{},images:[]},validationSchema:p,onSubmit:async function(r){m(!0);try{const o=new FormData;Object.keys(r).forEach((e=>{"specifications"===e?o.append(e,JSON.stringify(r[e])):"features"===e?o.append(e,JSON.stringify(r[e].filter(Boolean))):"images"===e?r[e].forEach((e=>{e instanceof File&&o.append("images",e)})):o.append(e,r[e])}));if(!(await fetch("".concat(f,"/api/admin/products").concat(t?"/".concat(s):""),{method:t?"PUT":"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:o})).ok)throw new Error("Failed to ".concat(t?"update":"create"," product"));S("Product ".concat(t?"updated":"created"," successfully")),e.push("/admin/products")}catch(o){console.error("Error ".concat(t?"updating":"creating"," product:"),o),S("Failed to ".concat(t?"update":"create"," product"),"error")}finally{m(!1)}}});(0,o.useEffect)((()=>{t&&s?F():n(!1),C()}),[t,s]);const F=async()=>{try{console.log("Fetching product from:","".concat(f,"/api/admin/products/").concat(s));const e=await fetch("".concat(f,"/api/admin/products/").concat(s),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(!e.ok){const s=await e.json().catch((()=>null));throw console.error("Product fetch error:",{status:e.status,statusText:e.statusText,error:s}),new Error("Failed to fetch product: ".concat(e.statusText))}const t=await e.json();console.log("Product data received:",t),k.setValues({name:t.name,description:t.description,price:t.price,stock:t.stock,categoryId:t.category.id,status:t.status,features:t.features||[""],specifications:t.specifications||{},images:t.images||[]}),y(t.images||[])}catch(e){console.error("Error fetching product:",e),S(e.message||"Failed to fetch product","error")}finally{n(!1)}},C=async()=>{try{console.log("Fetching categories from:","".concat(f,"/api/categories"));const e=await fetch("".concat(f,"/api/categories"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(!e.ok){const s=await e.json().catch((()=>null));throw console.error("Categories fetch error:",{status:e.status,statusText:e.statusText,error:s}),new Error("Failed to fetch categories: ".concat(e.statusText))}const s=await e.json();console.log("Categories data received:",s),g(s)}catch(e){console.error("Error fetching categories:",e),S(e.message||"Failed to fetch categories","error")}},S=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";N({show:!0,message:e,type:s})};return c?(0,r.jsx)(d.Z,{children:(0,r.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})}):(0,r.jsx)(d.Z,{children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:t?"Edit Product":"Add New Product"}),(0,r.jsxs)("form",{onSubmit:k.handleSubmit,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Basic Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Name"}),(0,r.jsx)("input",{type:"text",id:"name",...k.getFieldProps("name"),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),k.touched.name&&k.errors.name&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.errors.name})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"categoryId",className:"block text-sm font-medium text-gray-700",children:"Category"}),(0,r.jsxs)("select",{id:"categoryId",...k.getFieldProps("categoryId"),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",children:[(0,r.jsx)("option",{value:"",children:"Select a category"}),h.map((e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id)))]}),k.touched.categoryId&&k.errors.categoryId&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.errors.categoryId})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Price"}),(0,r.jsx)("input",{type:"number",id:"price",...k.getFieldProps("price"),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),k.touched.price&&k.errors.price&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.errors.price})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"stock",className:"block text-sm font-medium text-gray-700",children:"Stock"}),(0,r.jsx)("input",{type:"number",id:"stock",...k.getFieldProps("stock"),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),k.touched.stock&&k.errors.stock&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.errors.stock})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,r.jsxs)("select",{id:"status",...k.getFieldProps("status"),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",children:[(0,r.jsx)("option",{value:"active",children:"Active"}),(0,r.jsx)("option",{value:"inactive",children:"Inactive"})]}),k.touched.status&&k.errors.status&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.errors.status})]})]})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Description"}),(0,r.jsxs)("div",{children:[(0,r.jsx)(x,{value:k.values.description,onChange:e=>k.setFieldValue("description",e),modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["clean"]]},className:"h-64 mb-12"}),k.touched.description&&k.errors.description&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.errors.description})]})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Features"}),(0,r.jsx)("button",{type:"button",onClick:()=>{k.setFieldValue("features",[...k.values.features,""])},className:"inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Add Feature"})]}),k.values.features.map(((e,s)=>(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,r.jsx)("input",{type:"text",value:e,onChange:e=>{const t=[...k.values.features];t[s]=e.target.value,k.setFieldValue("features",t)},className:"flex-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Enter feature"}),s>0&&(0,r.jsx)("button",{type:"button",onClick:()=>(e=>{const s=[...k.values.features];s.splice(e,1),k.setFieldValue("features",s)})(s),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:(0,r.jsx)("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},s)))]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Specifications"}),(0,r.jsx)("button",{type:"button",onClick:()=>{const e=prompt("Enter specification key:");e&&k.setFieldValue("specifications",{...k.values.specifications,[e]:""})},className:"inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Add Specification"})]}),Object.entries(k.values.specifications).map((e=>{let[s,t]=e;return(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,r.jsx)("input",{type:"text",value:s,disabled:!0,className:"w-1/3 block border border-gray-300 rounded-md shadow-sm py-2 px-3 bg-gray-50 sm:text-sm"}),(0,r.jsx)("input",{type:"text",value:t,onChange:e=>{k.setFieldValue("specifications",{...k.values.specifications,[s]:e.target.value})},className:"flex-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),(0,r.jsx)("button",{type:"button",onClick:()=>(e=>{const s={...k.values.specifications};delete s[e],k.setFieldValue("specifications",s)})(s),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:(0,r.jsx)("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},s)}))]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Product Images"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:[v.map(((e,s)=>(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:e,alt:"Product ".concat(s+1),className:"h-32 w-32 object-cover rounded"}),(0,r.jsx)("button",{type:"button",onClick:()=>(e=>{w((s=>s.filter(((s,t)=>t!==e)))),y((s=>s.filter(((s,t)=>t!==e))))})(s),className:"absolute -top-2 -right-2 inline-flex items-center p-1 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:(0,r.jsx)("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},s))),(0,r.jsxs)("label",{className:"h-32 w-32 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const s=Array.from(e.target.files);w((e=>[...e,...s])),s.forEach((e=>{const s=new FileReader;s.onloadend=()=>{y((e=>[...e,s.result]))},s.readAsDataURL(e)}))},className:"hidden"}),(0,r.jsx)("svg",{className:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})]})]}),k.touched.images&&k.errors.images&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.errors.images})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)("button",{type:"button",onClick:()=>e.push("/admin/products"),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:l,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save Product"})]})]})]}),(0,r.jsx)(u.Z,{show:j.show,message:j.message,type:j.type,onClose:()=>N((e=>({...e,show:!1})))})]})})}))}},function(e){e.O(0,[3424,6920,7023,7594,374,9774,2888,179],(function(){return s=40050,e(e.s=s);var s}));var s=e.O();_N_E=s}]);