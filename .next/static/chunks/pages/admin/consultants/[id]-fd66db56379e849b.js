(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1877],{59157:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/consultants/[id]",function(){return r(28331)}])},28331:function(e,s,r){"use strict";r.r(s);var t=r(85893),a=r(67294),n=r(11163),o=r(82175),i=r(16310),l=r(5152),c=r.n(l),d=r(66308),u=r(57407),m=r(65858),h=(r(37676),r(83454));const x="https://miet-backend-five.vercel.app",p=c()((()=>Promise.all([r.e(2937),r.e(8446),r.e(1167)]).then(r.t.bind(r,71167,23))),{loadableGenerated:{webpack:()=>[71167]},ssr:!1,loading:()=>(0,t.jsx)("p",{children:"Loading editor..."})}),b=(h.env.NEXT_PUBLIC_TINYMCE_API_KEY,i.Ry({name:i.Z_().required("Name is required"),email:i.Z_().email("Invalid email").required("Email is required"),phone:i.Z_().required("Phone is required"),address:i.Z_().required("Address is required"),categories:i.IX().min(1,"Select at least one category").required("Categories are required"),ailments:i.IX().min(1,"Select at least one specialization").required("Specializations are required"),description:i.Z_().required("Description is required"),experience:i.Rx().min(0,"Experience must be positive").required("Experience is required"),education:i.Z_().required("Education is required"),services:i.IX().of(i.Ry({name:i.Z_().required("Service name is required"),price:i.Rx().min(0,"Price must be positive").required("Price is required"),duration:i.Rx().min(0,"Duration must be positive").required("Duration is required")})).min(1,"Add at least one service").required("Services are required")}));s.default=(0,m.Q)((function(){const e=(0,n.useRouter)(),{id:s}=e.query,r=Boolean(s),[i,l]=(0,a.useState)(!0),[c,m]=(0,a.useState)(!1),[h,g]=(0,a.useState)([]),[f,v]=(0,a.useState)([]),[j,w]=(0,a.useState)(null),[y,N]=(0,a.useState)(""),[k,C]=(0,a.useState)({show:!1,message:"",type:"success"}),q=(0,o.TA)({initialValues:{name:"",email:"",phone:"",address:"",categories:[],ailments:[],description:"",experience:"",education:"",services:[{name:"",price:"",duration:""}]},validationSchema:b,onSubmit:async function(t){m(!0);try{const a=new FormData;a.append("name",t.name),a.append("email",t.email),a.append("phone",t.phone),a.append("address",t.address),a.append("bio",t.description),a.append("experience",t.experience),a.append("education",t.education),t.categories.forEach((e=>{a.append("categories[]",e)})),t.ailments.forEach((e=>{a.append("ailments[]",e)})),a.append("services",JSON.stringify(t.services)),j&&a.append("image",j);const n=await fetch("".concat(x,"/api/consultants").concat(r?"/".concat(s):""),{method:r?"PATCH":"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:a});if(!n.ok){const e=await n.json();throw new Error(e.error||"Failed to ".concat(r?"update":"create"," consultant"))}_("Consultant ".concat(r?"updated":"created"," successfully")),e.push("/admin/consultants")}catch(a){console.error("Error ".concat(r?"updating":"creating"," consultant:"),a),_(a.message||"Failed to ".concat(r?"update":"create"," consultant"),"error")}finally{m(!1)}}});(0,a.useEffect)((()=>{r&&E(),S(),B()}),[r,s]);const E=async()=>{try{var e;const r=await fetch("".concat(x,"/api/consultants/").concat(s),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(!r.ok)throw new Error("Failed to fetch consultant");const t=await r.json();q.setValues({name:t.user.name,email:t.user.email,phone:t.user.phone,address:t.user.address,categories:t.categories.map((e=>e.id)),ailments:t.ailments.map((e=>e.id)),description:t.bio||"",experience:t.experience||"",education:t.education||"",services:(null===(e=t.services)||void 0===e?void 0:e.map((e=>({name:e.name,price:e.price,duration:e.duration}))))||[{name:"",price:"",duration:""}]}),t.image&&N(t.image)}catch(r){console.error("Error fetching consultant:",r),_("Failed to fetch consultant","error")}finally{l(!1)}},S=async()=>{try{const e=await fetch("".concat(x,"/api/categories"));if(!e.ok)throw new Error("Failed to fetch categories");const s=await e.json();g(s)}catch(e){console.error("Error fetching categories:",e),_("Failed to fetch categories","error")}},B=async()=>{try{const e=await fetch("".concat(x,"/api/ailments"));if(!e.ok)throw new Error("Failed to fetch ailments");const s=await e.json();v(s)}catch(e){console.error("Error fetching ailments:",e),_("Failed to fetch ailments","error")}},_=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";C({show:!0,message:e,type:s})};return i?(0,t.jsx)(d.Z,{children:(0,t.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})}):(0,t.jsx)(d.Z,{children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:r?"Edit Consultant":"Add New Consultant"}),(0,t.jsxs)("form",{onSubmit:q.handleSubmit,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),(0,t.jsx)("input",{type:"text",name:"name",value:q.values.name,onChange:q.handleChange,onBlur:q.handleBlur,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ".concat(q.touched.name&&q.errors.name?"border-red-500":"")}),q.touched.name&&q.errors.name&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.errors.name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,t.jsx)("input",{type:"email",name:"email",value:q.values.email,onChange:q.handleChange,onBlur:q.handleBlur,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ".concat(q.touched.email&&q.errors.email?"border-red-500":"")}),q.touched.email&&q.errors.email&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.errors.email})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,t.jsx)("input",{type:"tel",name:"phone",value:q.values.phone,onChange:q.handleChange,onBlur:q.handleBlur,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ".concat(q.touched.phone&&q.errors.phone?"border-red-500":"")}),q.touched.phone&&q.errors.phone&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.errors.phone})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),(0,t.jsx)("input",{type:"text",name:"address",value:q.values.address,onChange:q.handleChange,onBlur:q.handleBlur,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ".concat(q.touched.address&&q.errors.address?"border-red-500":"")}),q.touched.address&&q.errors.address&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.errors.address})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Categories"}),(0,t.jsx)("select",{multiple:!0,name:"categories",value:q.values.categories,onChange:q.handleChange,onBlur:q.handleBlur,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ".concat(q.touched.categories&&q.errors.categories?"border-red-500":""),children:h.map((e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id)))}),q.touched.categories&&q.errors.categories&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.errors.categories})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Specializations"}),(0,t.jsx)("select",{multiple:!0,name:"ailments",value:q.values.ailments,onChange:q.handleChange,onBlur:q.handleBlur,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ".concat(q.touched.ailments&&q.errors.ailments?"border-red-500":""),children:f.map((e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id)))}),q.touched.ailments&&q.errors.ailments&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.errors.ailments})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Experience (years)"}),(0,t.jsx)("input",{type:"number",name:"experience",value:q.values.experience,onChange:q.handleChange,onBlur:q.handleBlur,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ".concat(q.touched.experience&&q.errors.experience?"border-red-500":"")}),q.touched.experience&&q.errors.experience&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.errors.experience})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Education"}),(0,t.jsx)("input",{type:"text",name:"education",value:q.values.education,onChange:q.handleChange,onBlur:q.handleBlur,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ".concat(q.touched.education&&q.errors.education?"border-red-500":"")}),q.touched.education&&q.errors.education&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.errors.education})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,t.jsx)(p,{value:q.values.description,onChange:e=>q.setFieldValue("description",e),modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["clean"]]},className:"h-64 mb-12"}),q.touched.description&&q.errors.description&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.errors.description})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Services"}),(0,t.jsxs)("div",{className:"space-y-4",children:[q.values.services.map(((e,s)=>(0,t.jsxs)("div",{className:"flex items-end space-x-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Service Name"}),(0,t.jsx)("input",{type:"text",value:e.name,onChange:e=>{const r=[...q.values.services];r[s].name=e.target.value,q.setFieldValue("services",r)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Price"}),(0,t.jsx)("input",{type:"number",value:e.price,onChange:e=>{const r=[...q.values.services];r[s].price=e.target.value,q.setFieldValue("services",r)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Duration (minutes)"}),(0,t.jsx)("input",{type:"number",value:e.duration,onChange:e=>{const r=[...q.values.services];r[s].duration=e.target.value,q.setFieldValue("services",r)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),(0,t.jsx)("button",{type:"button",onClick:()=>(e=>{const s=[...q.values.services];s.splice(e,1),q.setFieldValue("services",s)})(s),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:(0,t.jsx)("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},s))),(0,t.jsxs)("button",{type:"button",onClick:()=>{q.setFieldValue("services",[...q.values.services,{name:"",price:"",duration:""}])},className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,t.jsx)("svg",{className:"-ml-1 mr-2 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Service"]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Profile Image"}),(0,t.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const s=e.target.files[0];if(s){w(s);const e=new FileReader;e.onloadend=()=>{N(e.result)},e.readAsDataURL(s)}},className:"hidden",id:"image-upload"}),(0,t.jsx)("label",{htmlFor:"image-upload",className:"cursor-pointer inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Choose Image"}),y&&(0,t.jsx)("div",{className:"ml-4",children:(0,t.jsx)("img",{src:y,alt:"Preview",className:"h-20 w-20 object-cover rounded-lg"})})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,t.jsx)("button",{type:"button",onClick:()=>e.push("/admin/consultants"),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:c,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save"})]})]})]}),(0,t.jsx)(u.Z,{show:k.show,message:k.message,type:k.type,onClose:()=>C((e=>({...e,show:!1})))})]})})}))}},function(e){e.O(0,[3424,6920,7023,7594,374,9774,2888,179],(function(){return s=59157,e(e.s=s);var s}));var s=e.O();_N_E=s}]);